<!DOCTYPE html>

<html>

    <head>

		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/p5.js"></script>
        <script src="touchy.js"></script>

        <script>
            var wheight = $(window).height();
            var wwidth = $(window).width();

            function setup() {
               
                // Make the canvas the size of the mobile device screen
                let canvas = createCanvas(windowWidth, windowHeight);
                canvas.parent('touch-me');
                background(0);
                
            }

            function doubleClicked(){
                fullscreen(true);
                redraw();
            }

            function windowResized() {
                resizeCanvas(windowWidth, windowHeight);
                background(0);
                redraw();
            }

            // default attributes
            var bgColor = "black";
            var penColor = "white";

            var penWeight = Math.ceil(wwidth / 500.0);
            var eraserWeight = wwidth / 10.0;
            var bulkEraserWeight = wheight / 2.0;


            var paths = [];
            
            // p5js draw function
            function draw() {
                // draw function for p5
                for (let i = 0; i < paths.length; i++) {
                    if (paths[i] == 0 || paths[i].points.length < 2) {
                        continue;
                    }
                    paths[i].display();
                }
            }

            Touchy.stopWindowBounce();

            $(function() {

                $('#touch-me').touchy(true, {

                    one: function(hand, finger) {

                        finger.on('start', function(point) {
                            
                            // setup a new line
                            paths.push(new Path());
                        });

                        finger.on('move', function(point) {
                            // add the current point to our existing line
                            paths[paths.length - 1].addPoint(point.x, point.y);
                        });
                    },

                    two: function(hand, finger1, finger2) {

                        let previous;

                        finger1.on('start', function (point) {

                            // Set up eraser around finger 1
                            strokeWeight(eraserWeight);
                            stroke("red");

                            // Save the first point (but don't draw)
                            previous = point;

                        });

                        finger1.on('move', function(point){
                            line(previous.x, previous.y, point.x, point.y);
                            previous = point;
                        });
                    },

                    four: function(hand, finger1, finger2, finger3, finger4) {
                    
                        let previous;

                        finger2.on('start', function(point) {
                            previous = point;
                        });

                        finger2.on('move', function(point) {
                            strokeWeight(bulkEraserWeight);
                            stroke(bgColor);
                            line(0, 0, 1920, 1080);
                        });
                    }
                });
            });

            function Path(color = "white") {
                // keep trak of the points on this line
                this.points = [];

                // keep track of the color
                this.color = color;
            }

            // function to add point to a path
            Path.prototype.addPoint = function(x, y) {
                this.points.push({x: x, y: y});
            }

            Path.prototype.display = function() {

                // setup the line
                noFill();
                strokeWeight(penWeight);
                stroke(this.color);
                beginShape();

                // iterate over all of the points on this line, add a vertex
                for (let i = 0; i < this.points.length; i++) {
                    curveVertex(this.points[i].x, this.points[i].y);
                }

                // end the line
                endShape();
            }

        </script>

        <style>
    
            html, body {
                height: 100%;
            }

            body {
                margin: 0;
                overflow: hidden;
            }

        </style>

        <title>CS50 Draw</title>

    </head>
    <body>
        <div id="touch-me"></div>
    </body>
</html>
